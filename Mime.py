# CC0 Public Domain: http://creativecommons.org/publicdomain/zero/1.0/

extension_dict = {
  '.3g2'                : 'video/3gpp2',
  '.3gp2'               : 'video/3gpp2',
  '.3gpp'               : 'video/3gpp',
  '.3gp'                : 'video/3gpp',
  '.323'                : 'text/h323',
  '.NMW'                : 'application/nmwb',
  '.aac'                : 'audio/aac',
  '.ac3'                : 'audio/ac3',
  '.accda'              : 'application/msaccess',
  '.accdb'              : 'application/msaccess',
  '.accdc'              : 'application/msaccess',
  '.accde'              : 'application/msaccess',
  '.accdr'              : 'application/msaccess',
  '.accdt'              : 'application/msaccess',
  '.ade'                : 'application/msaccess',
  '.adp'                : 'application/msaccess',
  '.adts'               : 'audio/aac',
  '.aifc'               : 'audio/aiff',
  '.aiff'               : 'audio/aiff',
  '.aif'                : 'audio/aiff',
  '.ai'                 : 'application/postscript',
  '.amc'                : 'application/x-mpeg',
  '.apng'               : 'image/png',
  '.application'        : 'application/x-ms-application',
  '.asf'                : 'video/x-ms-asf',
  '.asx'                : 'video/x-ms-asf',
  '.au'                 : 'audio/basic',
  '.avi'                : 'video/avi',
  '.bcpio'              : 'application/x-bcpio',
  '.bin'                : 'application/octet-stream',
  '.bmp'                : 'image/bmp',
  '.bz2'                : 'application/x-bzip',
  '.caf'                : 'audio/x-caf',
  '.cat'                : 'application/vnd.ms-pki.seccat',
  '.cbo'                : 'application/sha',
  '.cdda'               : 'audio/aiff',
  '.cdf'                : 'application/x-netcdf',
  '.cer'                : 'application/x-x509-ca-cert',
  '.cgm'                : 'image/cgm',
  '.class'              : 'application/octet-stream',
  '.conf'               : 'text/plain',
  '.cpio'               : 'application/x-cpio',
  '.cpt'                : 'application/mac-compactpro',
  '.crl'                : 'application/pkix-crl',
  '.crt'                : 'application/x-x509-ca-cert',
  '.csh'                : 'application/x-csh',
  '.css'                : 'text/css',
  '.csv'                : 'application/vnd.ms-excel',
  '.dcr'                : 'application/x-director',
  '.der'                : 'application/x-x509-ca-cert',
  '.dia'                : 'application/x-dia-diagram',
  '.dib'                : 'image/bmp',
  '.dif'                : 'video/x-dv',
  '.dir'                : 'application/x-director',
  '.djvu'               : 'image/vnd.djvu',
  '.djv'                : 'image/vnd.djvu',
  '.dll'                : 'application/octet-stream',
  '.dms'                : 'application/octet-stream',
  '.docm'               : 'application/vnd.ms-word.document.macroEnabled.12',
  '.docx'               : 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
  '.doc'                : 'application/msword',
  '.dotm'               : 'application/vnd.ms-word.template.macroEnabled.12',
  '.dotx'               : 'application/vnd.openxmlformats-officedocument.wordprocessingml.template',
  '.dot'                : 'application/msword',
  '.dtd'                : 'application/xml-dtd',
  '.dvi'                : 'application/x-dvi',
  '.dv'                 : 'video/x-dv',
  '.dwfx'               : 'application/x-opc+zip',
  '.dwg'                : 'application/acad',
  '.dxr'                : 'application/x-director',
  '.edn'                : 'application/vnd.adobe.edn',
  '.eml'                : 'message/rfc822',
  '.eps'                : 'application/postscript',
  '.etd'                : 'application/x-ebx',
  '.etx'                : 'text/x-setext',
  '.exe'                : 'application/octet-stream',
  '.ez'                 : 'application/andrew-inset',
  '.fdf'                : 'application/vnd.fdf',
  '.fif'                : 'application/fractals',
  '.flv'                : 'video/x-flv',
  '.gif'                : 'image/gif',
  '.gram'               : 'application/srgs',
  '.grxml'              : 'application/srgs+xml',
  '.gsm'                : 'audio/x-gsm',
  '.gtar'               : 'application/x-gtar',
  '.gz'                 : 'application/x-gzip',
  '.hdf'                : 'application/x-hdf',
  '.hqx'                : 'application/mac-binhex40',
  '.hta'                : 'application/hta',
  '.htc'                : 'text/x-component',
  '.html'               : 'text/html',
  '.htm'                : 'text/html',
  '.htt'                : 'text/webviewhtml',
  '.hxa'                : 'application/xml',
  '.hxc'                : 'application/xml',
  '.hxd'                : 'application/octet-stream',
  '.hxe'                : 'application/xml',
  '.hxf'                : 'application/xml',
  '.hxh'                : 'application/octet-stream',
  '.hxi'                : 'application/octet-stream',
  '.hxk'                : 'application/xml',
  '.hxq'                : 'application/octet-stream',
  '.hxr'                : 'application/octet-stream',
  '.hxs'                : 'application/octet-stream',
  '.hxt'                : 'application/xml',
  '.hxv'                : 'application/xml',
  '.hxw'                : 'application/octet-stream',
  '.ice'                : 'x-conference/x-cooltalk',
  '.ico'                : 'image/x-icon',
  '.ics'                : 'text/calendar',
  '.ief'                : 'image/ief',
  '.ifb'                : 'text/calendar',
  '.iges'               : 'model/iges',
  '.igs'                : 'model/iges',
  '.iii'                : 'application/x-iphone',
  '.ins'                : 'application/x-internet-signup',
  '.iqy'                : 'text/x-ms-iqy',
  '.isp'                : 'application/x-internet-signup',
  '.j2k'                : 'image/jp2',
  '.jar'                : 'application/x-jar',
  '.java'               : 'text/x-java',
  '.jfif'               : 'image/jpeg',
  '.jl'                 : 'text/x-sawfish',
  '.jnlp'               : 'application/x-java-jnlp-file',
  '.jp2'                : 'image/jp2',
  '.jpeg'               : 'image/jpeg',
  '.jpe'                : 'image/jpeg',
  '.jpg2'               : 'image/jp2',
  '.jpg'                : 'image/jpeg',
  '.jsp'                : 'text/x-jsp',
  '.js'                 : 'application/x-javascript',
  '.jtx'                : 'application/x-jtx+xps',
  '.kar'                : 'audio/midi',
  '.kml'                : 'application/xml',
  '.latex'              : 'application/x-latex',
  '.lha'                : 'application/octet-stream',
  '.log'                : 'text/plain',
  '.lzh'                : 'application/octet-stream',
  '.m1v'                : 'video/mpeg',
  '.m2v'                : 'video/mpeg',
  '.m3u'                : 'audio/x-mpegurl',
  '.mac'                : 'image/x-macpaint',
  '.man'                : 'application/x-troff-man',
  '.mathml'             : 'application/mathml+xml',
  '.mda'                : 'application/msaccess',
  '.mdb'                : 'application/msaccess',
  '.mde'                : 'application/msaccess',
  '.mesh'               : 'model/mesh',
  '.me'                 : 'application/x-troff-me',
  '.mfp'                : 'application/x-shockwave-flash',
  '.mhtml'              : 'message/rfc822',
  '.mht'                : 'message/rfc822',
  '.midi'               : 'audio/midi',
  '.midi'               : 'audio/mid',
  '.mid'                : 'audio/midi',
  '.mid'                : 'audio/mid',
  '.mif'                : 'application/vnd.mif',
  '.mka'                : 'audio/x-matroska',
  '.mka'                : 'video/x-matroska',
  '.mkv'                : 'audio/x-matroska',
  '.mkv'                : 'video/x-matroska',
  '.mod'                : 'video/mpeg',
  '.movie'              : 'video/x-sgi-movie',
  '.mov'                : 'video/quicktime',
  '.mp2v'               : 'video/mpeg',
  '.mp2'                : 'audio/mpeg',
  '.mp2'                : 'video/mpeg',
  '.mp3'                : 'audio/mpeg',
  '.mp4'                : 'video/mp4',
  '.mpa'                : 'video/mpeg',
  '.mpeg'               : 'video/mpeg',
  '.mpe'                : 'video/mpeg',
  '.mpf'                : 'application/vnd.ms-mediapackage',
  '.mpga'               : 'audio/mpeg',
  '.mpg'                : 'video/mpeg',
  '.mpv2'               : 'video/mpeg',
  '.mqv'                : 'video/quicktime',
  '.msh'                : 'model/mesh',
  '.ms'                 : 'application/x-troff-ms',
  '.mxu'                : 'video/vnd.mpegurl',
  '.nc'                 : 'application/x-netcdf',
  '.nws'                : 'message/rfc822',
  '.oda'                : 'application/oda',
  '.odb'                : 'application/vnd.oasis.opendocument.database',
  '.odc'                : 'application/vnd.oasis.opendocument.chart',
  '.odf'                : 'application/vnd.oasis.opendocument.formula',
  '.odg'                : 'application/vnd.oasis.opendocument.graphics',
  '.odi'                : 'application/vnd.oasis.opendocument.image',
  '.odm'                : 'application/vnd.oasis.opendocument.text-master',
  '.odp'                : 'application/vnd.oasis.opendocument.presentation',
  '.ods'                : 'application/vnd.oasis.opendocument.spreadsheet',
  '.odt'                : 'application/vnd.oasis.opendocument.text',
  '.oga'                : 'audio/ogg',
  '.ogg'                : 'video/ogg',
  '.ogm'                : 'video/ogg',
  '.ogv'                : 'video/ogg',
  '.ogx'                : 'application/ogg',
  '.ols'                : 'application/vnd.ms-publisher',
  '.otc'                : 'application/vnd.oasis.opendocument.chart-template',
  '.otf'                : 'application/vnd.oasis.opendocument.formula-template',
  '.otg'                : 'application/vnd.oasis.opendocument.graphics-template',
  '.oth'                : 'application/vnd.oasis.opendocument.text-web',
  '.oti'                : 'application/vnd.oasis.opendocument.image-template',
  '.otp'                : 'application/vnd.oasis.opendocument.presentation-template',
  '.ots'                : 'application/vnd.oasis.opendocument.spreadsheet-template',
  '.ott'                : 'application/vnd.oasis.opendocument.text-template',
  '.p7b'                : 'application/x-pkcs7-certificates',
  '.p7c'                : 'application/pkcs7-mime',
  '.p7m'                : 'application/pkcs7-mime',
  '.p7r'                : 'application/x-pkcs7-certreqresp',
  '.p7s'                : 'application/pkcs7-signature',
  '.p10'                : 'application/pkcs10',
  '.p12'                : 'application/x-pkcs12',
  '.pbm'                : 'image/x-portable-bitmap',
  '.pct'                : 'image/pict',
  '.pdb'                : 'chemical/x-pdb',
  '.pdf'                : 'application/pdf',
  '.pdx'                : 'application/vnd.adobe.pdx',
  '.pfx'                : 'application/x-pkcs12',
  '.pgm'                : 'image/x-portable-graymap',
  '.pgn'                : 'application/x-chess-pgn',
  '.php'                : 'text/x-php',
  '.pict'               : 'image/pict',
  '.pic'                : 'image/pict',
  '.pinstall'           : 'application/x-picasa-detect',
  '.pko'                : 'application/vnd.ms-pki.pko',
  '.png'                : 'image/png',
  '.pnm'                : 'image/x-portable-anymap',
  '.pntg'               : 'image/x-macpaint',
  '.pnt'                : 'image/x-macpaint',
  '.potm'               : 'application/x-opc+zip',
  '.potx'               : 'application/x-opc+zip',
  '.pot'                : 'application/vnd.ms-powerpoint',
  '.ppam'               : 'application/x-opc+zip',
  '.ppa'                : 'application/vnd.ms-powerpoint',
  '.ppm'                : 'image/x-portable-pixmap',
  '.ppsm'               : 'application/x-opc+zip',
  '.ppsx'               : 'application/x-opc+zip',
  '.pps'                : 'application/vnd.ms-powerpoint',
  '.pptm'               : 'application/x-opc+zip',
  '.pptx'               : 'application/x-opc+zip',
  '.ppt'                : 'application/vnd.ms-powerpoint',
  '.prf'                : 'application/pics-rules',
  '.psd'                : 'image/x-photoshop',
  '.ps'                 : 'application/postscript',
  '.pub'                : 'application/vnd.ms-publisher',
  '.pwz'                : 'application/vnd.ms-powerpoint',
  '.pyw'                : 'text/plain',
  '.py'                 : 'text/plain',
  '.qhtm'               : 'text/x-html-insertion',
  '.qht'                : 'text/x-html-insertion',
  '.qtif'               : 'image/x-quicktime',
  '.qtl'                : 'application/x-quicktimeplayer',
  '.qt'                 : 'video/quicktime',
  '.ram'                : 'audio/x-pn-realaudio',
  '.rar'                : 'application/x-rar',
  '.ras'                : 'image/x-cmu-raster',
  '.rat'                : 'application/rat-file',
  '.ra'                 : 'audio/x-realaudio',
  '.rdf'                : 'application/rdf+xml',
  '.rgb'                : 'image/x-rgb',
  '.rmf'                : 'application/vnd.adobe.rmf',
  '.rmi'                : 'audio/mid',
  '.rm'                 : 'audio/x-pn-realaudio',
  '.roff'               : 'application/x-troff',
  '.rpm'                : 'audio/x-pn-realaudio-plugin',
  '.rqy'                : 'text/x-ms-rqy',
  '.rss'                : 'text/xml',
  '.rtf'                : 'application/msword',
  '.rtx'                : 'text/richtext',
  '.sct'                : 'text/scriptlet',
  '.sd2'                : 'audio/x-sd2',
  '.sdp'                : 'application/sdp',
  '.sgml'               : 'text/sgml',
  '.sgm'                : 'text/sgml',
  '.shar'               : 'application/x-shar',
  '.shtml'              : 'text/html',
  '.sh'                 : 'application/x-sh',
  '.silo'               : 'model/mesh',
  '.sit'                : 'application/x-stuffit',
  '.skd'                : 'application/x-koan',
  '.skm'                : 'application/x-koan',
  '.skp'                : 'application/x-koan',
  '.skt'                : 'application/x-koan',
  '.sldm'               : 'application/vnd.ms-powerpoint.slide.macroEnabled.12',
  '.sldx'               : 'application/vnd.openxmlformats-officedocument.presentationml.slide',
  '.slk'                : 'application/vnd.ms-excel',
  '.smil'               : 'application/smil',
  '.smi'                : 'application/smil',
  '.snd'                : 'audio/basic',
  '.sol'                : 'text/plain',
  '.sor'                : 'text/plain',
  '.so'                 : 'application/octet-stream',
  '.spc'                : 'application/x-pkcs7-certificates',
  '.spl'                : 'application/futuresplash',
  '.spx'                : 'audio/ogg',
  '.src'                : 'application/x-wais-source',
  '.sst'                : 'application/vnd.ms-pki.certstore',
  '.stc'                : 'application/zip',
  '.std'                : 'application/zip',
  '.sti'                : 'application/zip',
  '.stl'                : 'application/vnd.ms-pki.stl',
  '.stm'                : 'application/zip',
  '.stw'                : 'application/zip',
  '.sv4cpio'            : 'application/x-sv4cpio',
  '.sv4crc'             : 'application/x-sv4crc',
  '.svg'                : 'image/svg+xml',
  '.swf'                : 'application/x-shockwave-flash',
  '.sxc'                : 'application/zip',
  '.sxd'                : 'application/zip',
  '.sxi'                : 'application/zip',
  '.sxm'                : 'application/zip',
  '.sxw'                : 'application/zip',
  '.tar'                : 'application/x-tar',
  '.tcl'                : 'application/x-tcl',
  '.texinfo'            : 'application/x-texinfo',
  '.texi'               : 'application/x-texinfo',
  '.tex'                : 'application/x-tex',
  '.thmx'               : 'application/vnd.ms-officetheme',
  '.tiff'               : 'image/tiff',
  '.tif'                : 'image/tiff',
  '.tr'                 : 'application/x-troff',
  '.tsv'                : 'text/tab-separated-values',
  '.txt'                : 'text/plain',
  '.t'                  : 'application/x-troff',
  '.uls'                : 'text/iuls',
  '.ustar'              : 'application/x-ustar',
  '.vcd'                : 'application/x-cdlink',
  '.vcf'                : 'text/x-vcard',
  '.vdx'                : 'application/vnd.ms-visio.viewer',
  '.vrml'               : 'model/vrml',
  '.vsd'                : 'application/vnd.ms-visio.viewer',
  '.vss'                : 'application/vnd.ms-visio.viewer',
  '.vst'                : 'application/vnd.ms-visio.viewer',
  '.vsx'                : 'application/vnd.ms-visio.viewer',
  '.vtx'                : 'application/vnd.ms-visio.viewer',
  '.vxml'               : 'application/voicexml+xml',
  '.wav'                : 'audio/wav',
  '.wax'                : 'audio/x-ms-wax',
  '.wbk'                : 'application/msword',
  '.wbmp'               : 'image/vnd.wap.wbmp',
  '.wbxml'              : 'application/vnd.wap.wbxml',
  '.wdp'                : 'image/vnd.ms-photo',
  '.webm'               : 'video/webm',
  '.webp'               : 'image/webp',
  '.wiz'                : 'application/msword',
  '.wma'                : 'audio/x-ms-wma',
  '.wmd'                : 'application/x-ms-wmd',
  '.wmlc'               : 'application/vnd.wap.wmlc',
  '.wmlsc'              : 'application/vnd.wap.wmlscriptc',
  '.wmls'               : 'text/vnd.wap.wmlscript',
  '.wml'                : 'text/vnd.wap.wml',
  '.wmv'                : 'video/x-ms-wmv',
  '.wmx'                : 'video/x-ms-wmx',
  '.wmz'                : 'application/x-ms-wmz',
  '.wm'                 : 'video/x-ms-wm',
  '.wpl'                : 'application/vnd.ms-wpl',
  '.wrl'                : 'model/vrml',
  '.wsc'                : 'text/scriptlet',
  '.wvx'                : 'video/x-ms-wvx',
  '.xaml'               : 'application/xaml+xml',
  '.xbap'               : 'application/x-ms-xbap',
  '.xbm'                : 'image/x-xbitmap',
  '.xdp'                : 'application/vnd.adobe.xdp+xml',
  '.xfdf'               : 'application/vnd.adobe.xfdf',
  '.xhtml'              : 'application/xhtml+xml',
  '.xht'                : 'application/xhtml+xml',
  '.xlam'               : 'application/vnd.ms-excel.addin.macroEnabled.12',
  '.xlam'               : 'application/x-opc+zip',
  '.xla'                : 'application/vnd.ms-excel',
  '.xlk'                : 'application/vnd.ms-excel',
  '.xll'                : 'application/vnd.ms-excel',
  '.xlm'                : 'application/vnd.ms-excel',
  '.xlsb'               : 'application/x-opc+zip',
  '.xlsm'               : 'application/x-opc+zip',
  '.xlsx'               : 'application/x-opc+zip',
  '.xls'                : 'application/vnd.ms-excel',
  '.xltm'               : 'application/x-opc+zip',
  '.xltx'               : 'application/x-opc+zip',
  '.xlt'                : 'application/vnd.ms-excel',
  '.xlw'                : 'application/vnd.ms-excel',
  '.xml'                : 'text/xml',
  '.xpi'                : 'application/x-xpinstall',
  '.xpm'                : 'image/x-xpixmap',
  '.xps'                : 'application/x-opc+zip',
  '.xsd'                : 'application/xml',
  '.xslt'               : 'text/xml',
  '.xsl'                : 'text/xml',
  '.xwd'                : 'image/x-xwindowdump',
  '.xyz'                : 'chemical/x-xyz',
  '.zip'                : 'application/zip',
}

try:
  import mimetypes
  _have_mimetypes = True
except:
  _have_mimetypes = False

def guess_extension_mime (lcext, fallback = None):
  dot = lcext.rfind ('.')
  if dot > 0:
    lcext = lcext[dot:]
  mime = extension_dict.get (lcext, None)
  if not mime and _have_mimetypes:
    mime = mimetypes.guess_type ('dummy' + lcext)[0]
  return mime if mime else fallback
